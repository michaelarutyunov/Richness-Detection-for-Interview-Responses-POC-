# Question Templates and LLM Prompts for Interview Question Generation
# Used by Question Generator to create natural follow-up questions

# ============================================================================
# Template-Based Questions (Fast, Deterministic)
# ============================================================================

templates:
  # DIG_DEEPER: Probe a specific node for more detail
  dig_deeper:
    - "You mentioned {node}. Can you tell me more about that?"
    - "What specifically about {node} stands out to you?"
    - "Help me understand why {node} matters to you."
    - "When you think about {node}, what comes to mind?"
    - "Could you elaborate on {node}?"
    - "What makes {node} important in this context?"

  # CONNECT_CONCEPTS: Ask about relationship between two nodes
  connect_concepts:
    - "You talked about {node_a} and {node_b}. How do these relate in your mind?"
    - "Is there a connection between {node_a} and {node_b} for you?"
    - "How does {node_a} lead to {node_b}?"
    - "What's the relationship between {node_a} and {node_b}?"

  # INTRODUCE_TOPIC: Bring up a seed node not yet discussed
  introduce_topic:
    - "Let's explore {topic}. What are your thoughts on that?"
    - "I'd like to hear about {topic}. Where should we start?"
    - "How do you feel about {topic}?"
    - "Tell me about your experience with {topic}."

  # SWITCH_TOPIC: Move to a different area of exploration
  switch_topic:
    - "Let's shift gears a bit. {new_topic_prompt}"
    - "I want to explore something different. {new_topic_prompt}"
    - "Changing topics - {new_topic_prompt}"

  # CLARIFY: Ask for clarification on ambiguous response
  clarification:
    - "I want to make sure I understand. Can you elaborate on that?"
    - "That's interesting. Could you give me an example?"
    - "Could you say more about what you mean by that?"
    - "Help me understand - what do you mean exactly?"

  # FALLBACK: Generic safe question when all else fails
  fallback:
    - "Tell me more about your experience with this product."
    - "What else comes to mind when you think about this?"
    - "Is there anything else you'd like to share?"

# ============================================================================
# LLM-Based Question Generation (Natural, Context-Aware)
# ============================================================================

llm_question_generation:
  system_prompt: |
    You are an expert interviewer conducting marketing research.
    Your goal is to generate natural, conversational follow-up questions that:

    1. Sound HUMAN, not robotic or scripted
    2. Use the participant's own language when possible
    3. Are open-ended (encourage elaboration, not yes/no)
    4. Feel warm and curious, not interrogative
    5. Are concise (ideally under 20 words)
    6. Avoid starting with "Why" (use "What makes you say that?" instead)
    7. ONE question at a time (no multi-part questions)

    INTERVIEW GUIDELINES:
    - Use conversational transitions ("That's interesting...", "I'm curious...")
    - Reflect participant's energy (if they're enthusiastic, match it)
    - Avoid jargon or marketing speak
    - Don't assume - ask for specifics
    - Make participant feel heard (reference their previous points)

    BAD EXAMPLES:
    ❌ "Why do you feel that way?" (too direct)
    ❌ "Can you tell me more about your purchase decision-making process?" (too formal)
    ❌ "What are your thoughts on X and also Y and how do they relate?" (multi-part)

    GOOD EXAMPLES:
    ✅ "What makes that important to you?"
    ✅ "Tell me more about that experience."
    ✅ "When you say 'convenient', what does that look like for you?"

  user_prompt_template: |
    # INTERVIEW CONTEXT

    **Action**: {opportunity_action}
    **Focus**: {target_info}

    **Recent Conversation** (for natural flow):
    {recent_conversation}

    **Last Question Asked**:
    "{last_question}"

    # TASK

    Generate a natural follow-up question that:
    - Addresses the interview action: {opportunity_action}
    - Focuses on: {target_info}
    - Feels like a natural continuation of the conversation
    - Doesn't repeat the last question or sound similar
    - Is warm, curious, and conversational

    Return ONLY the question text (no preamble, no explanation).
    Keep it under 25 words.

  # Fallback prompt if detailed context unavailable
  simple_prompt_template: |
    Generate a natural, conversational follow-up question for a marketing interview.

    The interviewer wants to: {opportunity_action}
    Focus area: {target_info}

    Question should:
    - Be open-ended
    - Sound natural and conversational
    - Be under 20 words

    Return only the question.

# ============================================================================
# Repetition Detection
# ============================================================================

repetition_check:
  # Keywords that signal similar questions
  similarity_keywords:
    dig_deeper: ["tell me more", "elaborate", "explain", "what about", "more about"]
    connect: ["relate", "connection", "lead to", "how does"]
    introduce: ["thoughts on", "feel about", "experience with"]

  # Minimum word overlap to flag as repetitive (Jaccard similarity)
  word_overlap_threshold: 0.6

  # Phrases to add variety when repetition detected
  variety_phrases:
    - "Building on that, "
    - "Following up on what you said, "
    - "That's helpful. Now, "
    - "Interesting. "
    - "Got it. "

# ============================================================================
# Question Quality Checks
# ============================================================================

quality_checks:
  # Maximum question length (words)
  max_words: 30

  # Forbidden starts (too formal/abrupt)
  forbidden_starts:
    - "Why do you"
    - "Why are you"
    - "Do you think"
    - "Would you say"

  # Encouraged starts (natural, conversational)
  encouraged_starts:
    - "What"
    - "How"
    - "Tell me"
    - "Can you"
    - "When you"

  # Auto-fix: Convert "Why" to "What makes"
  auto_fixes:
    - from: "^Why do you (.+)"
      to: "What makes you {1}"
    - from: "^Why is (.+) important"
      to: "What makes {1} important to you"
